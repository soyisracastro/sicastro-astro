---
import PageLayout from '@/layouts/PageLayout.astro';
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';
import Button from '@/components/ui/Button.astro';
import SectionTitle from '@/components/ui/SectionTitle.astro';
import StatCard from '@/components/StatCard.astro';
import PricingPlanCard from '@/components/PricingPlanCard.astro';
import LeadMagnetCard from '@/components/LeadMagnetCard.astro';
import TestimonialCard from '@/components/TestimonialCard.astro';
import BlogCard from '@/components/BlogCard.astro';
import FAQItem from '@/components/FAQItem.astro';
import { defaultSEO, stats, testimonials, faqItems } from '@/lib/data';
import { fetchGraphQL } from '@/lib/wordpress/client';
import { GET_POSTS } from '@/lib/wordpress/queries';
import type { PostsQueryResponse } from '@/lib/wordpress/types';

// Fetch latest blog posts from WordPress
let blogPosts: Array<{
  title: string;
  excerpt: string;
  date: string;
  slug: string;
  category?: string;
  image?: string;
  author?: string;
}> = [];

try {
  const data = await fetchGraphQL<PostsQueryResponse>(GET_POSTS, { first: 3 });
  
  blogPosts = data.posts.nodes.map(post => ({
    title: post.title,
    excerpt: post.excerpt.replace(/<[^>]*>/g, '').trim(),
    date: post.date,
    slug: post.slug,
    category: post.categories.nodes[0]?.name,
    image: post.featuredImage?.node.sourceUrl,
    author: post.author.node.name,
  }));
} catch (error) {
  console.error('Error fetching blog posts:', error);
}
---

<PageLayout seo={defaultSEO}>
  <!-- Hero Section - 2 columnas -->
  <Section padding="none" class="bg-white">
    <Container class="py-24 md:py-32">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <!-- Columna izquierda: Texto -->
        <div>
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-6 text-text-primary leading-tight">
            ¬øCansado de las Sorpresas del SAT?
          </h1>
          <p class="text-xl md:text-2xl mb-6 text-text-secondary leading-relaxed">
            Llevamos tu contabilidad o resolvemos tus dudas fiscales para que te enfoques en hacer crecer tu negocio
          </p>
          
          <!-- Credenciales -->
          <div class="flex flex-wrap gap-4 text-sm text-text-tertiary mb-8">
            <span class="flex items-center">
              <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Contadores certificados
            </span>
            <span class="flex items-center">
              <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              +25 a√±os de experiencia
            </span>
            <span class="flex items-center">
              <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              100% en l√≠nea
            </span>
          </div>

          <!-- CTAs -->
          <div class="flex flex-col sm:flex-row gap-3 mb-6">
            <Button href="/asesoria" size="lg" variant="primary">
              Asesor√≠a 1:1
            </Button>
            <Button href="#servicios" size="lg" variant="secondary">
              Planes de Contabilidad
            </Button>
          </div>

          <!-- Disclaimer -->
          <p class="text-sm text-text-tertiary">
            Sin compromisos a largo plazo ¬∑ Servicio en toda la Rep√∫blica
          </p>
        </div>

        <!-- Columna derecha: Imagen placeholder -->
        <div class="relative">
          <div class="aspect-square rounded-lg border border-border bg-background p-12 flex items-center justify-center">
            <div class="text-center">
              <div class="text-7xl mb-6">üíº</div>
              <p class="text-lg text-text-secondary">Contador en videollamada</p>
              <p class="text-sm text-text-tertiary mt-2">[Placeholder para imagen]</p>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Stats Section -->
  <Section background="background">
    <Container>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-12 md:gap-16">
        {stats.map(stat => (
          <StatCard stat={stat} />
        ))}
      </div>
    </Container>
  </Section>

  <!-- Lead Magnet - Test Interactivo -->
  <Section background="white">
    <Container>
      <LeadMagnetCard />
    </Container>
  </Section>

  <!-- Pricing Plans Section -->
  <Section background="background" id="servicios">
    <Container>
      <SectionTitle
        title="Servicios Dise√±ados para tu Tranquilidad Fiscal"
        subtitle="Elige el plan que se adapte a tu etapa de crecimiento"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
        <PricingPlanCard
          title="PLAN B√ÅSICO"
          price="$3,500/mes*"
          description="Lo esencial para estar en regla"
          features={[
            'Declaraciones mensuales',
            'Contabilidad fiscal',
            'Gesti√≥n SAT',
            '1 asesor√≠a mensual'
          ]}
          idealFor="Profesionistas independientes sin empleados"
          ctaText="Ver Detalles"
          ctaHref="/servicios"
        />

        <PricingPlanCard
          title="PLAN PREMIUM"
          price="$6,200/mes*"
          description="Todo lo que necesitas para crecer"
          features={[
            'Todo lo del Plan B√°sico',
            'N√≥mina hasta 5 empleados',
            'Estados financieros',
            'Planeaci√≥n fiscal trimestral',
            'Asesor√≠a prioritaria'
          ]}
          idealFor="Negocios con empleados"
          ctaText="Ver Detalles"
          ctaHref="/servicios"
          popular={true}
        />

        <PricingPlanCard
          title="PLAN EMPRESARIAL"
          price="Desde $10,500/mes*"
          description="Soluciones para empresas"
          features={[
            'Contabilidad corporativa completa',
            'N√≥mina hasta 50 empleados',
            'Planeaci√≥n fiscal mensual',
            'Acompa√±amiento estrat√©gico'
          ]}
          idealFor="Personas morales"
          ctaText="Cotizar"
          ctaHref="/contacto"
        />
      </div>

      <p class="text-center text-sm text-text-tertiary mb-8">
        *Impuestos incluidos ¬∑ Sin costos ocultos ¬∑ Cancela cuando quieras ¬∑ Servicio 100% en l√≠nea
      </p>

      <div class="text-center">
        <Button href="/servicios" variant="secondary" size="lg">
          Ver M√°s Servicios ‚Üí
        </Button>
      </div>
    </Container>
  </Section>

  <!-- About Preview Section - Historia -->
  <Section background="white">
    <Container>
      <div class="max-w-4xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-6 text-text-primary">
          El Equipo que Cuida tus Finanzas
        </h2>
        <p class="text-lg mb-6 text-text-secondary leading-relaxed">
          Desde 1999, hemos sido el aliado contable de cientos de profesionistas y empresarios en M√©xico. Lo que comenz√≥ como un peque√±o despacho en Guerrero, hoy es S & I Castro Consultores: un equipo de 3 contadores p√∫blicos certificados comprometidos con tu tranquilidad fiscal, sin importar d√≥nde te encuentres.
        </p>
        <p class="text-lg mb-10 text-text-secondary leading-relaxed">
          Combinamos experiencia de m√°s de 25 a√±os con tecnolog√≠a y actualizaci√≥n constante en reformas fiscales. Trabajamos 100% en l√≠nea para brindarte el mismo servicio personalizado que ofrec√≠amos presencialmente, pero con la comodidad de atenderte desde cualquier lugar de M√©xico.
        </p>
        <Button href="/sobre-nosotros" variant="primary" size="lg">
          Conoce Nuestra Historia Completa ‚Üí
        </Button>
      </div>
    </Container>
  </Section>

  <!-- Testimonials Section -->
  <Section background="background">
    <Container>
      <SectionTitle
        title="Lo Que Dicen Nuestros Clientes"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {testimonials.map(testimonial => (
          <TestimonialCard testimonial={testimonial} />
        ))}
      </div>
    </Container>
  </Section>

  <!-- Blog Preview Section -->
  <Section background="white">
    <Container>
      <SectionTitle
        title="Mantente Actualizado en Materia Fiscal"
        subtitle="Tips, noticias y gu√≠as para que tomes mejores decisiones"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
        {blogPosts.map(post => (
          <BlogCard {...post} />
        ))}
      </div>

      <div class="text-center">
        <Button href="/blog" variant="primary" size="lg">
          Ver Todos los Art√≠culos
        </Button>
      </div>
    </Container>
  </Section>

  <!-- FAQ Section -->
  <Section background="background">
    <Container>
      <SectionTitle
        title="Preguntas Frecuentes"
      />
      
      <div class="max-w-3xl mx-auto">
        <div class="bg-white rounded-lg border border-border p-8 md:p-10">
          {faqItems.map((item, index) => (
            <FAQItem item={item} index={index} />
          ))}
        </div>
      </div>

    </Container>
  </Section>

  <!-- CTA Final Section -->
  <Section background="white">
    <Container>
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-6 text-text-primary">
          ¬øListo para Tener tus Finanzas en Orden?
        </h2>
        <p class="text-xl mb-10 text-text-secondary leading-relaxed">
          Agenda una consulta sin costo y descubre c√≥mo podemos ayudarte a crecer sin preocupaciones fiscales
        </p>
        
        <div class="flex flex-col sm:flex-row gap-3 justify-center mb-8">
          <Button href="/agendar" variant="primary" size="lg">
            Agendar Consulta Gratuita
          </Button>
          <Button href="#servicios" variant="secondary" size="lg">
            Ver Nuestros Planes
          </Button>
        </div>

        <div class="flex flex-wrap justify-center gap-6 text-sm text-text-tertiary">
          <span class="flex items-center">
            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Sin compromiso
          </span>
          <span class="flex items-center">
            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            100% confidencial
          </span>
          <span class="flex items-center">
            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Atenci√≥n en l√≠nea
          </span>
          <span class="flex items-center">
            <svg class="w-5 h-5 mr-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Respuesta en 24 hrs
          </span>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Newsletter CTA Section -->
  <Section background="background">
    <Container>
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-6 text-text-primary">
          Recibe Tips Fiscales en tu Correo
        </h2>
        <p class="text-lg mb-10 text-text-secondary leading-relaxed">
          Mantente al d√≠a con las √∫ltimas actualizaciones fiscales, deducciones que puedes aprovechar y consejos pr√°cticos para tu negocio
        </p>
        
        <form class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto" action="/newsletter" method="POST">
          <input
            type="email"
            name="email"
            placeholder="tu@email.com"
            required
            class="flex-1 px-4 py-3 rounded-md border border-border text-text-primary placeholder:text-text-tertiary focus:outline-none focus:border-primary transition-colors bg-white"
          />
          <Button type="submit" variant="primary" size="lg" class="whitespace-nowrap">
            Suscribirse
          </Button>
        </form>
        
        <p class="text-sm mt-6 text-text-tertiary">
          Al suscribirte, aceptas nuestra <a href="/aviso-privacidad" class="text-primary hover:text-primary-dark underline transition-colors">Pol√≠tica de Privacidad</a>
        </p>
      </div>
    </Container>
  </Section>
</PageLayout>
