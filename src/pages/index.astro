---
import PageLayout from '@/layouts/PageLayout.astro';
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';
import Button from '@/components/ui/Button.astro';
import SectionTitle from '@/components/ui/SectionTitle.astro';
import ServiceCard from '@/components/ServiceCard.astro';
import StatCard from '@/components/StatCard.astro';
import TestimonialCard from '@/components/TestimonialCard.astro';
import BlogCard from '@/components/BlogCard.astro';
import FAQItem from '@/components/FAQItem.astro';
import { defaultSEO, stats, testimonials, faqItems, companyInfo } from '@/lib/data';
import { getFeaturedServices } from '@/lib/services';
import { fetchGraphQL } from '@/lib/wordpress/client';
import { GET_POSTS } from '@/lib/wordpress/queries';
import type { PostsQueryResponse } from '@/lib/wordpress/types';

const featuredServices = getFeaturedServices();

// Fetch latest blog posts from WordPress
let blogPosts: Array<{
  title: string;
  excerpt: string;
  date: string;
  slug: string;
  category?: string;
  image?: string;
  author?: string;
}> = [];

try {
  const data = await fetchGraphQL<PostsQueryResponse>(GET_POSTS, { first: 3 });
  
  blogPosts = data.posts.nodes.map(post => ({
    title: post.title,
    excerpt: post.excerpt.replace(/<[^>]*>/g, '').trim(), // Strip HTML tags from excerpt
    date: post.date,
    slug: post.slug,
    category: post.categories.nodes[0]?.name,
    image: post.featuredImage?.node.sourceUrl,
    author: post.author.node.name,
  }));
} catch (error) {
  console.error('Error fetching blog posts:', error);
  // Fallback to empty array if WordPress is unavailable
}
---

<PageLayout seo={defaultSEO}>
  <!-- Hero Section -->
  <Section padding="none" class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-primary"></div>
    <div class="absolute inset-0 bg-dark/30"></div>
    <div class="absolute inset-0">
      <div class="absolute inset-0 bg-[url('/images/patterns/grid.svg')] opacity-10"></div>
    </div>
    
    <Container class="relative z-10 py-20 md:py-32">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="font-heading text-5xl md:text-6xl lg:text-7xl font-bold mb-6 text-white drop-shadow-lg animate-fade-in">
          Tu Socio Estrat√©gico en Materia Fiscal y Contable
        </h1>
        <p class="text-xl md:text-2xl mb-8 text-white drop-shadow-md animate-slide-up">
          M√°s de 15 a√±os de experiencia brindando soluciones integrales a empresas en M√©xico
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center animate-slide-up">
          <Button href="/servicios" size="lg" variant="secondary">
            Ver Servicios
          </Button>
          <Button href="/contacto" size="lg" variant="outline" class="bg-white/10 hover:bg-white hover:text-primary border-white">
            Solicitar Consulta
          </Button>
        </div>
      </div>
    </Container>

    <!-- Wave divider -->
    <div class="absolute bottom-0 left-0 right-0">
      <svg viewBox="0 0 1200 120" preserveAspectRatio="none" class="w-full h-16 fill-background" style="display: block; transform: scaleY(-1);">
        <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"></path>
      </svg>
    </div>
  </Section>

  <!-- Stats Section -->
  <Section background="background">
    <Container>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-12">
        {stats.map(stat => (
          <StatCard stat={stat} />
        ))}
      </div>
    </Container>
  </Section>

  <!-- Featured Services Section -->
  <Section background="white">
    <Container>
      <SectionTitle
        title="Nuestros Servicios"
        subtitle="Soluciones integrales dise√±adas para el √©xito de tu empresa"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        {featuredServices.map(service => (
          <ServiceCard service={service} />
        ))}
      </div>

      <div class="text-center">
        <Button href="/servicios" variant="primary" size="lg">
          Ver Todos los Servicios
        </Button>
      </div>
    </Container>
  </Section>

  <!-- About Preview Section -->
  <Section background="gradient">
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <div class="animate-on-scroll">
          <h2 class="font-heading text-4xl md:text-5xl font-bold mb-6">
            {companyInfo.name}
          </h2>
          <p class="text-lg mb-6 text-white/90">
            {companyInfo.description}
          </p>
          <p class="text-lg mb-6 text-white/90">
            Fundados en {companyInfo.founded}, nos hemos consolidado como uno de los despachos contables m√°s confiables de M√©xico, ofreciendo servicios de alta calidad respaldados por un equipo de profesionales certificados.
          </p>
          <ul class="space-y-3 mb-8">
            <li class="flex items-start">
              <svg class="w-6 h-6 mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>Equipo de profesionales certificados</span>
            </li>
            <li class="flex items-start">
              <svg class="w-6 h-6 mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>Tecnolog√≠a de vanguardia</span>
            </li>
            <li class="flex items-start">
              <svg class="w-6 h-6 mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              <span>Atenci√≥n personalizada</span>
            </li>
          </ul>
          <Button href="/sobre-nosotros" variant="secondary" size="lg">
            Conoce M√°s Sobre Nosotros
          </Button>
        </div>
        
        <div class="relative animate-on-scroll">
          <div class="aspect-square rounded-lg bg-white/10 backdrop-blur-sm p-8">
            <div class="h-full flex items-center justify-center">
              <div class="text-center">
                <div class="text-6xl mb-4">üèÜ</div>
                <p class="text-2xl font-bold mb-2">+500</p>
                <p class="text-lg">Clientes Satisfechos</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Testimonials Section -->
  <Section background="background">
    <Container>
      <SectionTitle
        title="Lo Que Dicen Nuestros Clientes"
        subtitle="La confianza de nuestros clientes es nuestro mejor respaldo"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {testimonials.map(testimonial => (
          <TestimonialCard testimonial={testimonial} />
        ))}
      </div>
    </Container>
  </Section>

  <!-- Blog Preview Section -->
  <Section background="white">
    <Container>
      <SectionTitle
        title="√öltimas Noticias"
        subtitle="Mantente informado sobre las novedades fiscales y contables"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
        {blogPosts.map(post => (
          <BlogCard {...post} />
        ))}
      </div>

      <div class="text-center">
        <Button href="/blog" variant="primary" size="lg">
          Ver Todos los Art√≠culos
        </Button>
      </div>
    </Container>
  </Section>

  <!-- FAQ Section -->
  <Section background="background">
    <Container>
      <SectionTitle
        title="Preguntas Frecuentes"
        subtitle="Resolvemos tus dudas sobre nuestros servicios"
      />
      
      <div class="max-w-3xl mx-auto">
        <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
          {faqItems.map((item, index) => (
            <FAQItem item={item} index={index} />
          ))}
        </div>
      </div>

      <div class="text-center mt-12">
        <p class="text-lg text-dark-light mb-4">
          ¬øTienes m√°s preguntas? Estamos aqu√≠ para ayudarte
        </p>
        <Button href="/contacto" variant="primary" size="lg">
          Cont√°ctanos
        </Button>
      </div>
    </Container>
  </Section>

  <!-- Newsletter CTA Section -->
  <Section background="gradient">
    <Container>
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="font-heading text-4xl md:text-5xl font-bold mb-6">
          Suscr√≠bete a Nuestro Newsletter
        </h2>
        <p class="text-xl mb-8 text-white/90">
          Recibe las √∫ltimas actualizaciones fiscales, tips contables y noticias relevantes directamente en tu correo
        </p>
        
        <form class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto" action="/newsletter" method="POST">
          <input
            type="email"
            name="email"
            placeholder="tu@email.com"
            required
            class="flex-1 px-6 py-4 rounded-lg text-dark focus:outline-none focus:ring-2 focus:ring-white"
          />
          <Button type="submit" variant="secondary" size="lg" class="whitespace-nowrap">
            Suscribirse
          </Button>
        </form>
        
        <p class="text-sm mt-4 text-white/70">
          Al suscribirte, aceptas nuestra <a href="/aviso-privacidad" class="underline hover:text-white">Pol√≠tica de Privacidad</a>
        </p>
      </div>
    </Container>
  </Section>
</PageLayout>

