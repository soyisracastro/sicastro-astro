---
import PageLayout from '@/layouts/PageLayout.astro';
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';
import Button from '@/components/ui/Button.astro';
import SectionTitle from '@/components/ui/SectionTitle.astro';
import ServiceCard from '@/components/ServiceCard.astro';
import StatCard from '@/components/StatCard.astro';
import TestimonialCard from '@/components/TestimonialCard.astro';
import BlogCard from '@/components/BlogCard.astro';
import FAQItem from '@/components/FAQItem.astro';
import { defaultSEO, stats, testimonials, faqItems, companyInfo } from '@/lib/data';
import { getFeaturedServices } from '@/lib/services';
import { fetchGraphQL } from '@/lib/wordpress/client';
import { GET_POSTS } from '@/lib/wordpress/queries';
import type { PostsQueryResponse } from '@/lib/wordpress/types';

const featuredServices = getFeaturedServices();

// Fetch latest blog posts from WordPress
let blogPosts: Array<{
  title: string;
  excerpt: string;
  date: string;
  slug: string;
  category?: string;
  image?: string;
  author?: string;
}> = [];

try {
  const data = await fetchGraphQL<PostsQueryResponse>(GET_POSTS, { first: 3 });
  
  blogPosts = data.posts.nodes.map(post => ({
    title: post.title,
    excerpt: post.excerpt.replace(/<[^>]*>/g, '').trim(),
    date: post.date,
    slug: post.slug,
    category: post.categories.nodes[0]?.name,
    image: post.featuredImage?.node.sourceUrl,
    author: post.author.node.name,
  }));
} catch (error) {
  console.error('Error fetching blog posts:', error);
}
---

<PageLayout seo={defaultSEO}>
  <!-- Hero Section - Minimalista con jerarqu√≠a tipogr√°fica -->
  <Section padding="none" class="bg-white">
    <Container class="py-24 md:py-32">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 text-text-primary leading-tight">
          Tu Socio Estrat√©gico en Materia Fiscal y Contable
        </h1>
        <p class="text-xl md:text-2xl mb-10 text-text-secondary leading-relaxed">
          M√°s de 15 a√±os de experiencia brindando soluciones integrales a empresas en M√©xico
        </p>
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
          <Button href="/servicios" size="lg" variant="primary">
            Ver Servicios
          </Button>
          <Button href="/contacto" size="lg" variant="secondary">
            Solicitar Consulta
          </Button>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Stats Section -->
  <Section background="background">
    <Container>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-12 md:gap-16">
        {stats.map(stat => (
          <StatCard stat={stat} />
        ))}
      </div>
    </Container>
  </Section>

  <!-- Featured Services Section -->
  <Section background="white">
    <Container>
      <SectionTitle
        title="Nuestros Servicios"
        subtitle="Soluciones integrales dise√±adas para el √©xito de tu empresa"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
        {featuredServices.map(service => (
          <ServiceCard service={service} />
        ))}
      </div>

      <div class="text-center">
        <Button href="/servicios" variant="primary" size="lg">
          Ver Todos los Servicios
        </Button>
      </div>
    </Container>
  </Section>

  <!-- About Preview Section - Fondo blanco -->
  <Section background="background">
    <Container>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
        <div>
          <h2 class="text-4xl md:text-5xl font-bold mb-6 text-text-primary">
            {companyInfo.name}
          </h2>
          <p class="text-lg mb-6 text-text-secondary leading-relaxed">
            {companyInfo.description}
          </p>
          <p class="text-lg mb-8 text-text-secondary leading-relaxed">
            Fundados en {companyInfo.founded}, nos hemos consolidado como uno de los despachos contables m√°s confiables de M√©xico, ofreciendo servicios de alta calidad respaldados por un equipo de profesionales certificados.
          </p>
          <ul class="space-y-3 mb-10">
            <li class="flex items-start text-base text-text-primary">
              <span class="mr-3 mt-1 text-text-tertiary">‚Ä¢</span>
              <span>Equipo de profesionales certificados</span>
            </li>
            <li class="flex items-start text-base text-text-primary">
              <span class="mr-3 mt-1 text-text-tertiary">‚Ä¢</span>
              <span>Tecnolog√≠a de vanguardia</span>
            </li>
            <li class="flex items-start text-base text-text-primary">
              <span class="mr-3 mt-1 text-text-tertiary">‚Ä¢</span>
              <span>Atenci√≥n personalizada</span>
            </li>
          </ul>
          <Button href="/sobre-nosotros" variant="primary" size="lg">
            Conoce M√°s Sobre Nosotros
          </Button>
        </div>
        
        <div class="relative">
          <div class="aspect-square rounded-lg border border-border bg-white p-12 flex items-center justify-center">
            <div class="text-center">
              <div class="text-7xl mb-6">üèÜ</div>
              <p class="text-5xl font-bold mb-3 text-text-primary">+500</p>
              <p class="text-lg text-text-secondary">Clientes Satisfechos</p>
            </div>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Testimonials Section -->
  <Section background="white">
    <Container>
      <SectionTitle
        title="Lo Que Dicen Nuestros Clientes"
        subtitle="La confianza de nuestros clientes es nuestro mejor respaldo"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        {testimonials.map(testimonial => (
          <TestimonialCard testimonial={testimonial} />
        ))}
      </div>
    </Container>
  </Section>

  <!-- Blog Preview Section -->
  <Section background="background">
    <Container>
      <SectionTitle
        title="√öltimas Noticias"
        subtitle="Mantente informado sobre las novedades fiscales y contables"
      />
      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
        {blogPosts.map(post => (
          <BlogCard {...post} />
        ))}
      </div>

      <div class="text-center">
        <Button href="/blog" variant="primary" size="lg">
          Ver Todos los Art√≠culos
        </Button>
      </div>
    </Container>
  </Section>

  <!-- FAQ Section -->
  <Section background="white">
    <Container>
      <SectionTitle
        title="Preguntas Frecuentes"
        subtitle="Resolvemos tus dudas sobre nuestros servicios"
      />
      
      <div class="max-w-3xl mx-auto">
        <div class="bg-white rounded-lg border border-border p-8 md:p-10">
          {faqItems.map((item, index) => (
            <FAQItem item={item} index={index} />
          ))}
        </div>
      </div>

      <div class="text-center mt-12">
        <p class="text-lg text-text-secondary mb-4">
          ¬øTienes m√°s preguntas? Estamos aqu√≠ para ayudarte
        </p>
        <Button href="/contacto" variant="primary" size="lg">
          Cont√°ctanos
        </Button>
      </div>
    </Container>
  </Section>

  <!-- Newsletter CTA Section - Fondo claro -->
  <Section background="background">
    <Container>
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-4xl md:text-5xl font-bold mb-6 text-text-primary">
          Suscr√≠bete a Nuestro Newsletter
        </h2>
        <p class="text-xl mb-10 text-text-secondary leading-relaxed">
          Recibe las √∫ltimas actualizaciones fiscales, tips contables y noticias relevantes directamente en tu correo
        </p>
        
        <form class="flex flex-col sm:flex-row gap-3 max-w-md mx-auto" action="/newsletter" method="POST">
          <input
            type="email"
            name="email"
            placeholder="tu@email.com"
            required
            class="flex-1 px-4 py-3 rounded-md border border-border text-text-primary placeholder:text-text-tertiary focus:outline-none focus:border-primary transition-colors bg-white"
          />
          <Button type="submit" variant="primary" size="lg" class="whitespace-nowrap">
            Suscribirse
          </Button>
        </form>
        
        <p class="text-sm mt-6 text-text-tertiary">
          Al suscribirte, aceptas nuestra <a href="/aviso-privacidad" class="text-primary hover:text-primary-dark underline transition-colors">Pol√≠tica de Privacidad</a>
        </p>
      </div>
    </Container>
  </Section>
</PageLayout>
